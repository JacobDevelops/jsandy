import { Canvas, Meta } from '@storybook/blocks';
import { Callout } from '@/storybook/components/Callout';
import { Kbd } from '@/storybook/components/Kbd';
import { PropsTable, PropDefinition } from '@/storybook/components/PropsTable';

import * as AvatarStories from './Avatar.stories';

<Meta of={AvatarStories} />

# Avatar Component

The Avatar component provides a consistent way to represent users with profile pictures or fallback content. It's designed to handle various states of image loading and provides intelligent fallback options for when images are unavailable.

## Features

- Automatic handling of image loading states
- Customizable fallback display for when images are unavailable
- Flexible sizing options through className prop
- Support for delayed fallback to prevent flickering during image loading
- Accessible design with appropriate attributes

## Installation

To use the Avatar component in your project, install it via npm:

```bash
npm install @jsandy/ui
```

## Usage

Here's a basic example of how to use the Avatar component:

```jsx
import { Avatar, AvatarImage, AvatarFallback } from '@jsandy/ui';

function MyComponent() {
  return (
    <Avatar>
      <AvatarImage src="https://example.com/profile.jpg" alt="User's profile" />
      <AvatarFallback>JD</AvatarFallback>
    </Avatar>
  );
}
```

## Basic Usage

<Canvas of={AvatarStories.Default} />

## With Fallback

The Avatar component displays the fallback content when the image fails to load:

<Canvas of={AvatarStories.WithFallback} />

<Callout type="info">
  The fallback will automatically display when the image source is invalid, doesn't exist, or
  encounters a loading error.
</Callout>

## Sizing Options

You can adjust the size of the Avatar by applying custom class names:

<Canvas of={AvatarStories.Sizes} />

```jsx
<Avatar className="h-8 w-8">
  {/* Small avatar */}
</Avatar>

<Avatar>
  {/* Default size (h-10 w-10) */}
</Avatar>

<Avatar className="h-14 w-14">
  {/* Large avatar */}
</Avatar>
```

## Delayed Fallback

To prevent flickering when images might load quickly, you can add a delay before showing the fallback:

<Canvas of={AvatarStories.WithDelay} />

```jsx
<Avatar>
  <AvatarImage src="path/to/image.jpg" alt="User profile" />
  <AvatarFallback delayMs={600}>JD</AvatarFallback>
</Avatar>
```

## Avatar Groups

You can create avatar groups by using negative margins and borders:

<Canvas of={AvatarStories.Group} />

## Using Icons as Fallback

You can use icons from your design system instead of text for the fallback:

<Canvas of={AvatarStories.WithIcon} />

## Custom Colors

You can customize the appearance of avatars with different background colors:

<Canvas of={AvatarStories.CustomColors} />

## Error Handling

The Avatar component is designed to gracefully handle various error scenarios:

<Canvas of={AvatarStories.ErrorHandling} />

## Non-Circular Avatars

While avatars are circular by default, you can customize the shape by applying border radius classes:

<Canvas of={AvatarStories.WithRoundedCorners} />

## API Reference

### Avatar Component

<PropsTable
  props={[
    {
      name: 'children',
      type: 'React.ReactNode',
      description:
        'The content of the avatar, typically AvatarImage and AvatarFallback components.',
    },
    {
      name: 'className',
      type: 'string',
      description: 'Additional CSS classes to apply to the avatar for styling.',
    },
    {
      name: 'asChild',
      type: 'boolean',
      defaultValue: 'false',
      description:
        'When true, the component will render its child directly, applying props to it instead of creating a new DOM element.',
    },
  ]}
/>

### AvatarImage Component

<PropsTable
  props={[
    {
      name: 'src',
      type: 'string',
      description: 'The URL of the image to be displayed.',
      required: true,
    },
    {
      name: 'alt',
      type: 'string',
      description: 'Alternative text description of the image for accessibility.',
      required: true,
    },
    {
      name: 'onLoadingStatusChange',
      type: '(status: "idle" | "loading" | "loaded" | "error") => void',
      description:
        'Callback function that is triggered when the loading status of the image changes.',
    },
    {
      name: 'className',
      type: 'string',
      description: 'Additional CSS classes to apply to the image.',
    },
  ]}
/>

### AvatarFallback Component

<PropsTable
  props={[
    {
      name: 'children',
      type: 'React.ReactNode',
      description:
        'The content to display when the image is unavailable, typically initials or an icon.',
      required: true,
    },
    {
      name: 'delayMs',
      type: 'number',
      description:
        'The delay in milliseconds before showing the fallback element. This helps prevent flickering when images might load quickly.',
    },
    {
      name: 'className',
      type: 'string',
      description: 'Additional CSS classes to apply to the fallback element.',
    },
  ]}
/>

## Accessibility

The Avatar component is built with accessibility in mind:

- Proper alt text should be provided for all avatar images
- The fallback content provides a visual alternative when images are unavailable
- The component structure ensures proper focus management

<Callout type="warning">
  Always provide meaningful alternative text for avatar images that describes the user or entity the
  avatar represents.
</Callout>

## Best Practices

1. **Always include fallback content** - Ensure users have a visual cue even when images don't load
2. **Use meaningful initials or icons** - Fallback content should help identify the user when possible
3. **Optimize image loading** - Use appropriately sized and optimized images for avatars
4. **Consider contrast** - Ensure text fallbacks have sufficient contrast with background colors
5. **Consistency** - Use avatars consistently throughout your application for a coherent user experience

<Callout type="info">
  For best performance, consider using an image CDN that can dynamically resize avatar images to
  match the display size you need.
</Callout>

## Related Components

- **Badge** - Often used in conjunction with avatars to show status
- **UserMenu** - Avatars are frequently used as triggers for user menus
- **Comment** - Avatars are commonly used in comment interfaces to represent the commenter
